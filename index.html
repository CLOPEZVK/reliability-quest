<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reliability Quest: Legend of Uptime</title>
    <style>
        :root {
            --bg-color: #1a1a1d;
            --panel-bg: #2d2d30;
            --accent-gold: #c5a059;
            --accent-red: #a94442;
            --accent-green: #4e9a53;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --font-header: 'Courier New', Courier, monospace; /* Fallback for fantasy feel */
            --font-body: system-ui, -apple-system, sans-serif;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-body);
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .game-container {
            width: 100%;
            max-width: 800px;
            background: var(--panel-bg);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Header */
        header {
            background: #000;
            padding: 1rem;
            text-align: center;
            border-bottom: 3px solid var(--accent-gold);
        }
        
        h1 { margin: 0; font-family: var(--font-header); color: var(--accent-gold); text-transform: uppercase; letter-spacing: 2px; font-size: 1.5rem; }
        h2 { font-family: var(--font-header); color: var(--accent-gold); margin-top: 0;}

        /* Screens */
        .screen {
            padding: 2rem;
            flex: 1;
            display: none; /* Hidden by default */
            flex-direction: column;
            animation: fadeIn 0.5s ease;
        }
        
        .screen.active { display: flex; }

        /* Class Selection */
        .class-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .class-card {
            border: 1px solid var(--text-muted);
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(255,255,255,0.05);
        }

        .class-card:hover {
            border-color: var(--accent-gold);
            background: rgba(197, 160, 89, 0.1);
            transform: translateY(-2px);
        }

        .class-icon { font-size: 2rem; margin-bottom: 0.5rem; display: block; }
        .class-title { font-weight: bold; color: var(--accent-gold); font-family: var(--font-header); }
        .class-desc { font-size: 0.9rem; color: var(--text-muted); margin-top: 0.5rem; }

        /* Gameplay UI */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--text-muted);
            font-family: var(--font-header);
        }

        .stat-box span { font-weight: bold; color: var(--accent-gold); }

        .narrative-box {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
            padding-right: 0.5rem;
            min-height: 200px;
        }

        .story-text { font-size: 1.1rem; line-height: 1.6; margin-bottom: 1.5rem; }
        .log-entry { font-size: 0.9rem; padding: 0.5rem; border-left: 3px solid var(--text-muted); margin-bottom: 0.5rem; background: rgba(0,0,0,0.2); }
        .log-entry.success { border-color: var(--accent-green); }
        .log-entry.fail { border-color: var(--accent-red); }

        .choice-container {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        button.choice-btn {
            background: transparent;
            border: 1px solid var(--accent-gold);
            color: var(--accent-gold);
            padding: 1rem;
            font-family: var(--font-header);
            font-size: 1rem;
            cursor: pointer;
            text-align: left;
            transition: 0.2s;
        }

        button.choice-btn:hover {
            background: var(--accent-gold);
            color: #000;
        }

        button.choice-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .dice-area {
            text-align: center;
            margin: 1rem 0;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5rem;
            color: var(--accent-gold);
        }

        .dice-roll-anim {
            animation: shake 0.5s infinite;
        }

        /* End Screen */
        .result-card {
            text-align: center;
            padding: 2rem;
            border: 2px solid var(--accent-gold);
            border-radius: 10px;
        }
        
        .badge {
            font-size: 3rem;
            margin: 1rem 0;
        }

        .btn-primary {
            background: var(--accent-gold);
            color: #000;
            border: none;
            padding: 1rem 2rem;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            margin-top: 2rem;
            font-family: var(--font-header);
        }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }

        /* Mobile Tweaks */
        @media (max-width: 600px) {
            .class-grid { grid-template-columns: 1fr; }
            .stats-bar { flex-direction: column; gap: 0.5rem; text-align: center; }
        }
    </style>
</head>
<body>

<div class="game-container">
    <header>
        <h1>Reliability Quest</h1>
        <div style="font-size: 0.8rem; color: #888;">The Legend of Uptime in Assetia</div>
    </header>

    <!-- 1. Start Screen / Class Selection -->
    <div id="start-screen" class="screen active">
        <div style="text-align: center; margin-bottom: 1rem;">
            <h2>Choose Your Hero</h2>
            <p>The Realm of Assetia is in danger. Who will save the production line?</p>
        </div>
        
        <div class="class-grid" id="class-list">
            <!-- Classes injected via JS -->
        </div>
    </div>

    <!-- 2. Game Screen -->
    <div id="game-screen" class="screen">
        <!-- Stats Header -->
        <div class="stats-bar">
            <div class="stat-box">HERO: <span id="hero-name-display"></span></div>
            <div class="stat-box">ASSET UPTIME (HP): <span id="hp-display">100%</span></div>
            <div class="stat-box">RELIABILITY XP: <span id="xp-display">0</span></div>
        </div>

        <!-- Main Narrative Area -->
        <div class="narrative-box" id="story-log">
            <!-- Story content goes here -->
        </div>

        <!-- Dice Roll Animation Area -->
        <div class="dice-area" id="dice-area"></div>

        <!-- Player Choices -->
        <div class="choice-container" id="choices-area">
            <!-- Buttons injected via JS -->
        </div>
    </div>

    <!-- 3. End Screen -->
    <div id="end-screen" class="screen">
        <div class="result-card">
            <h2 id="end-title">Quest Complete</h2>
            <div class="badge" id="end-icon">üèÜ</div>
            <p id="end-desc">The kingdom is safe.</p>
            
            <div style="margin-top: 2rem; text-align: left; background: rgba(0,0,0,0.2); padding: 1rem;">
                <p><strong>Final Uptime:</strong> <span id="final-hp"></span></p>
                <p><strong>Reliability Score:</strong> <span id="final-xp"></span></p>
                <p><strong>Title Earned:</strong> <span id="final-rank"></span></p>
            </div>

            <button class="btn-primary" onclick="location.reload()">Play Again</button>
        </div>
    </div>
</div>

<script>
    // --- GAME DATA ---

    const CLASSES = [
        {
            id: 'knight',
            name: 'Condition Knight',
            role: 'CBM Specialist',
            icon: 'üõ°Ô∏è',
            desc: 'Master of sensors. Bonuses to Detection and Early Warning.',
            bonusType: 'detect'
        },
        {
            id: 'sage',
            name: 'Data Sage',
            role: 'Data Analyst',
            icon: 'üîÆ',
            desc: 'Reader of trends. Bonuses to History and Root Cause.',
            bonusType: 'analyze'
        },
        {
            id: 'cleric',
            name: 'Planner Cleric',
            role: 'Planner/Scheduler',
            icon: 'üìú',
            desc: 'Keeper of parts. Bonuses to Planning and Resource Prep.',
            bonusType: 'plan'
        },
        {
            id: 'wrench',
            name: 'Wrenchblade',
            role: 'Technician',
            icon: 'üîß',
            desc: 'Field warrior. Bonuses to Repair and Physical Inspection.',
            bonusType: 'repair'
        },
        {
            id: 'wizard',
            name: 'Reliability Wizard',
            role: 'Reliability Engineer',
            icon: '‚ö°',
            desc: 'Architect of strategy. Bonuses to FMEA and System Changes.',
            bonusType: 'strategy'
        }
    ];

    // The Adventure Steps
    const SCENARIOS = [
        {
            id: 1,
            title: "Stage 1: The Asset Awakens",
            text: "You arrive at Pump Station 7. The operators report a 'Screech of Doom' during the afternoon shift. The asset is trembling.",
            choices: [
                { 
                    text: "Use IR Scanner & Vib Analysis", 
                    type: "detect", 
                    classRef: "knight",
                    success: "You spot a bearing fault immediately! You schedule a precise replacement.",
                    fail: "The readings are fuzzy. You guess it's a bearing, but you aren't sure." 
                },
                { 
                    text: "Pull Historical SCADA Data", 
                    type: "analyze", 
                    classRef: "sage",
                    success: "Trendlines show a gradual heat rise over 30 days. This was predictable!",
                    fail: "Data is corrupt! You spend hours cleaning spreadsheets while the pump screeches." 
                },
                { 
                    text: "Tighten Components & Inspect", 
                    type: "repair", 
                    classRef: "wrench",
                    success: "Your skilled hands find a loose mount. It buys time, though not a root cause.",
                    fail: "You tighten a bolt too far and snap it. Whoops." 
                },
                { 
                    text: "Check PM Schedule", 
                    type: "plan", 
                    classRef: "cleric",
                    success: "Aha! The PM was skipped last month. You generate an emergency work order immediately.",
                    fail: "The paperwork is a mess. You can't tell when it was last greased." 
                }
            ]
        },
        {
            id: 2,
            title: "Stage 2: The Dungeon of Downtime",
            text: "The pump has been taken offline for repair. But wait! The store room is dark and chaotic. We need the spare impeller NOW.",
            choices: [
                {
                    text: "Inventory Incantation (Check BOM)",
                    type: "plan",
                    classRef: "cleric",
                    success: "Your BOM is accurate. You find the part in Bin 4B instantly.",
                    fail: "The system says 'In Stock', but the bin is empty. Ghost inventory!"
                },
                {
                    text: "Cannibalize from Old Asset",
                    type: "repair",
                    classRef: "wrench",
                    success: "It's not pretty, but you refurbish an old part to get running. Production is saved.",
                    fail: "The old part doesn't fit. Now you have two broken pumps."
                },
                {
                    text: "Analyze Supply Chain Lead Times",
                    type: "analyze",
                    classRef: "sage",
                    success: "You realize this vendor is always late. You trigger an expedited shipment you set up years ago.",
                    fail: "Spreadsheets won't make the truck drive faster. Downtime ticks up."
                }
            ]
        },
        {
            id: 3,
            title: "Stage 3: The Reliability Gauntlet",
            text: "The asset is running, but the 'Demon of Unreliability' (Repeat Failures) looms. How do we stop this from happening next month?",
            choices: [
                {
                    text: "Cast FMEA Storm",
                    type: "strategy",
                    classRef: "wizard",
                    success: "You identify the failure mode and redesign the maintenance strategy. The Demon vanishes!",
                    fail: " The meeting drags on for 4 hours. No one agrees on the RPN score."
                },
                {
                    text: "Install Continuous Monitoring",
                    type: "detect",
                    classRef: "knight",
                    success: "Wireless sensors installed. The asset will never surprise us again.",
                    fail: "The sensors won't connect to the Wi-Fi. A tech nightmare."
                },
                {
                    text: "Re-write the PM Procedure",
                    type: "plan",
                    classRef: "cleric",
                    success: "Clear, concise instructions. The techs applaud your clarity.",
                    fail: "You write a 50-page document that no one will ever read."
                }
            ]
        }
    ];

    // --- STATE MANAGEMENT ---

    let state = {
        heroClass: null,
        hp: 100, // Represents Asset Health / Uptime
        xp: 0,   // Represents Reliability Score
        currentScenario: 0,
        logHistory: []
    };

    // --- DOM ELEMENTS ---
    const screens = {
        start: document.getElementById('start-screen'),
        game: document.getElementById('game-screen'),
        end: document.getElementById('end-screen')
    };
    
    const elClassList = document.getElementById('class-list');
    const elStoryLog = document.getElementById('story-log');
    const elChoices = document.getElementById('choices-area');
    const elDice = document.getElementById('dice-area');

    const elHeroName = document.getElementById('hero-name-display');
    const elHp = document.getElementById('hp-display');
    const elXp = document.getElementById('xp-display');

    // --- INITIALIZATION ---

    function init() {
        renderClassSelection();
    }

    function renderClassSelection() {
        elClassList.innerHTML = '';
        CLASSES.forEach(cls => {
            const card = document.createElement('div');
            card.className = 'class-card';
            card.onclick = () => startGame(cls);
            card.innerHTML = `
                <span class="class-icon">${cls.icon}</span>
                <div class="class-title">${cls.name}</div>
                <div style="font-size: 0.8rem; color: #c5a059; margin-bottom: 0.5rem;">${cls.role}</div>
                <div class="class-desc">${cls.desc}</div>
            `;
            elClassList.appendChild(card);
        });
    }

    function switchScreen(screenName) {
        Object.values(screens).forEach(s => s.classList.remove('active'));
        screens[screenName].classList.add('active');
    }

    function startGame(selectedClass) {
        state.heroClass = selectedClass;
        state.hp = 100;
        state.xp = 0;
        state.currentScenario = 0;
        state.logHistory = [];

        // UI Updates
        elHeroName.innerText = `${selectedClass.name}`;
        elHeroName.innerHTML += ` <span style="font-size:0.8em">${selectedClass.icon}</span>`;
        elStoryLog.innerHTML = `<p class="story-text" style="color:var(--accent-gold)">Welcome, ${selectedClass.name}. The journey begins...</p>`;

        switchScreen('game');
        updateStats();
        loadScenario();
    }

    function updateStats() {
        elHp.innerText = state.hp + "%";
        elXp.innerText = state.xp;
        
        // Color coding health
        if(state.hp < 50) elHp.style.color = "var(--accent-red)";
        else elHp.style.color = "var(--accent-green)";
    }

    function loadScenario() {
        const scenario = SCENARIOS[state.currentScenario];
        
        // Add story text
        const storyBlock = document.createElement('div');
        storyBlock.innerHTML = `
            <h3 style="color:var(--accent-gold); border-bottom: 1px solid #444; padding-bottom:5px;">${scenario.title}</h3>
            <p class="story-text">${scenario.text}</p>
        `;
        elStoryLog.appendChild(storyBlock);
        elStoryLog.scrollTop = elStoryLog.scrollHeight;

        // Render Choices
        elChoices.innerHTML = '';
        scenario.choices.forEach((choice, index) => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            
            // Add class specific flavor icon if matches
            let icon = "üëâ";
            if (choice.type === state.heroClass.bonusType) icon = "‚ú®"; 
            
            btn.innerHTML = `${icon} ${choice.text}`;
            btn.onclick = () => handleChoice(choice);
            elChoices.appendChild(btn);
        });
    }

    function handleChoice(choice) {
        // Disable buttons
        const btns = document.querySelectorAll('.choice-btn');
        btns.forEach(b => b.disabled = true);

        elDice.innerHTML = "üé≤ Rolling...";
        elDice.classList.add('dice-roll-anim');

        // Simulate Roll Delay
        setTimeout(() => {
            elDice.classList.remove('dice-roll-anim');
            resolveAction(choice);
        }, 1000);
    }

    function resolveAction(choice) {
        // D20 Logic
        let rawRoll = Math.floor(Math.random() * 20) + 1;
        let modifier = 0;
        let isClassMatch = (choice.type === state.heroClass.bonusType) || (choice.classRef === state.heroClass.id);

        // Bonus for matching class specialty
        if (isClassMatch) {
            modifier = 5;
        }

        let total = rawRoll + modifier;
        let success = total >= 12; // DC (Difficulty Class) is 12

        // Critical Success
        if (rawRoll === 20) {
            total = "CRIT!";
            success = true;
        }

        // Visual Feedback
        let resultColor = success ? "var(--accent-green)" : "var(--accent-red)";
        elDice.innerHTML = `<span style="color:${resultColor}">Rolled: ${total}</span> <span style="font-size:0.6em; color:#888">(d20 + ${modifier})</span>`;

        // Apply Outcomes
        if (success) {
            state.xp += (rawRoll === 20) ? 50 : 25;
            addLog(choice.success, "success");
        } else {
            state.hp -= 20;
            state.xp += 5; // You learn from failure
            addLog(choice.fail, "fail");
        }

        updateStats();

        // Next Step
        setTimeout(() => {
            state.currentScenario++;
            elDice.innerHTML = "";
            
            if (state.hp <= 0) {
                endGame(false);
            } else if (state.currentScenario >= SCENARIOS.length) {
                endGame(true);
            } else {
                loadScenario();
            }
        }, 2000);
    }

    function addLog(text, type) {
        const log = document.createElement('div');
        log.className = `log-entry ${type}`;
        log.innerText = text;
        elStoryLog.appendChild(log);
        elStoryLog.scrollTop = elStoryLog.scrollHeight;
    }

    function endGame(victory) {
        switchScreen('end');
        
        const finalHpEl = document.getElementById('final-hp');
        const finalXpEl = document.getElementById('final-xp');
        const finalRankEl = document.getElementById('final-rank');
        const titleEl = document.getElementById('end-title');
        const descEl = document.getElementById('end-desc');
        const iconEl = document.getElementById('end-icon');

        finalHpEl.innerText = state.hp + "%";
        finalXpEl.innerText = state.xp;

        if (!victory) {
            titleEl.innerText = "Production Halted";
            iconEl.innerText = "‚ò†Ô∏è";
            descEl.innerText = "The asset failed catastrophically. The line is down.";
            finalRankEl.innerText = "The Fallen Technician";
            titleEl.style.color = "var(--accent-red)";
        } else {
            titleEl.innerText = "Reliability Hero!";
            titleEl.style.color = "var(--accent-gold)";
            
            if (state.xp >= 100 && state.hp >= 80) {
                iconEl.innerText = "üëë";
                descEl.innerText = "Flawless performance! World Class Reliability achieved.";
                finalRankEl.innerText = "Grandmaster of Assetia";
            } else if (state.xp >= 50) {
                iconEl.innerText = "üõ°Ô∏è";
                descEl.innerText = "Good work. The asset is running, though we have some follow-ups.";
                finalRankEl.innerText = "Guardian of Uptime";
            } else {
                iconEl.innerText = "ü©π";
                descEl.innerText = "You survived... barely. Reactive maintenance is exhausting.";
                finalRankEl.innerText = "The Firefighter";
            }
        }
    }

    // Run
    init();

</script>

</body>
</html>
